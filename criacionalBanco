create table FOR_FORNECEDOR(
	PK_FOR_IDFORNECEDOR SERIAL PRIMARY KEY,
	FOR_NOM_NOME VARCHAR(90),
	FOR_COD_IDENTIFICADOR VARCHAR(90),
	FOR_NUM_NUMEROTELEFONE VARCHAR(13),
	FOR_NOM_EMAIL VARCHAR(90),
	FOR_COD_CONTABANCARIA VARCHAR(90),
	FOR_NOM_AGENCIABANCARIA VARCHAR(90)
);

CREATE TABLE CLI_CLIENTE(
	PK_CLI_IDCLIENTE SERIAL PRIMARY KEY,
	CLI_NOM_NOME VARCHAR(90),
	CLI_COD_CPF VARCHAR(13),
	CLI_NUM_NUMEROTELEFONE VARCHAR(13),
	CLI_NOM_EMAIL VARCHAR(90)
);

CREATE TABLE FUN_FUNCIONARIO(
	PK_FUN_IDFUNCIONARIO SERIAL PRIMARY KEY,
	FUN_NOM_NOME VARCHAR(90),
	FUN_COD_CPF VARCHAR(13),
	FUN_NUM_NUMEROTELEFONE VARCHAR(13),
	FUN_NOM_EMAIL VARCHAR(90),
	FUN_DAT_DATANASCIMENTO DATE,
	FUN_COD_CONTABANCARIA VARCHAR(90),
	FUN_NOM_AGENCIABANCARIA VARCHAR(90)
);

CREATE TABLE MAR_MARCA(
	PK_MAR_IDMARCA SERIAL PRIMARY KEY,
	MAR_NOM_NOME VARCHAR(90)
);

CREATE TABLE EST_ESTOQUE(
	PK_EST_IDESTOQUE SERIAL PRIMARY KEY,
	EST_DSC_ENDERECO VARCHAR(90),
	EST_NUM_NUMEROENDERECO INT
);

CREATE TABLE MOD_MODELO(
	PK_MOD_IDMODELO SERIAL PRIMARY KEY,
	FK_MAR_IDMARCA_MOD INT,
	MOD_TIP_TIPOVEICULO VARCHAR(90),
	MOD_NOM_NOMEMODELO VARCHAR(90),
	FOREIGN KEY(FK_MAR_IDMARCA_MOD) REFERENCES MAR_MARCA(PK_MAR_IDMARCA)
);

CREATE TABLE VEI_VEICULO(
	PK_VEI_IDVEICULO SERIAL PRIMARY KEY,
	FK_FOR_IDFORNECEDOR_VEI INT,
	FK_MOD_IDMODELO_VEI INT,
	VEI_VLR_VALORFORNECEDOR DOUBLE PRECISION,
	VEI_VLR_VALORTABELAFIPE DOUBLE PRECISION,
	VEI_DSC_PLACA VARCHAR(8),
	VEI_DSC_COR VARCHAR(20),
	VEI_NUM_ANOFABRICACAO INT,
	VEI_VLR_QUILOMETRAGEM DOUBLE PRECISION,
	FOREIGN KEY(FK_FOR_IDFORNECEDOR_VEI) REFERENCES FOR_FORNECEDOR(PK_FOR_IDFORNECEDOR),
	FOREIGN KEY(FK_MOD_IDMODELO_VEI) REFERENCES MOD_MODELO(PK_MOD_IDMODELO)
);

CREATE TABLE RVE_RELACIONAMENTO_VEICULO_ESTOQUE(
	PK_RVE_IDRELACIONAMENTO SERIAL PRIMARY KEY,
	FK_EST_IDESTOQUE_RVE INT,
	FK_VEI_IDVEICULO_RVE INT,
	RVE_DAT_DATAENTRADA DATE,
	RVE_DAT_DATASAIDA DATE
	
);

CREATE TABLE VEN_VENDA(
	PK_VEN_IDVENDA SERIAL PRIMARY KEY,
	FK_FUN_IDFUNCIONARIO_VEN INT,
	FK_VEI_IDVEICULO_VEN INT,
	FK_CLI_IDCLIENTE_VEN INT,
	VEN_VLR_VENDA DOUBLE PRECISION,
	VEN_PCO_COMISSAO DOUBLE PRECISION,
	VEN_DSC_STATUSVEICULO VARCHAR(90),
	VEN_DAT_DATAVENDA DATE,
	VEN_DSC_TIPOCOMPRA VARCHAR(90),
	FOREIGN KEY(FK_FUN_IDFUNCIONARIO_VEN) REFERENCES FUN_FUNCIONARIO(PK_FUN_IDFUNCIONARIO),
	FOREIGN KEY(FK_VEI_IDVEICULO_VEN) REFERENCES VEI_VEICULO(PK_VEI_IDVEICULO),
	FOREIGN KEY(FK_CLI_IDCLIENTE_VEN) REFERENCES CLI_CLIENTE(PK_CLI_IDCLIENTE)
);

CREATE VIEW REL_RELATORIOFINANCEIRO AS
SELECT
    v.PK_IDVEN_VENDA AS IDVENDA,
	c.VEI_DSC_PLACA AS PLACA,
	c.VEI_DSC_COR AS COR, 
	m.MOD_NOM_NOMEMODELO AS MODELO,
	m.MOD_TIP_TIPOVEICULO AS TIPOVEICULO,
	a.MAR_NOM_NOME AS MARCA,
    v.VEN_DSC_STATUSVEICULO AS STATUSVEICULO,
	fu.FUN_NOM_NOME AS NOMEFUNCIONARIO,
	cli.CLI_NOM_NOME AS CLIENTENOME,
    v.VEN_DAT_DATAVENDA AS DATAVENDA,
    v.VEN_DSC_TIPOCOMPRA AS TIPOCOMPRA,
    v.VEN_VLR_VENDA AS VALORVENDA,    
    c.VEI_VLR_VALORTABELAFIPE AS VALORTABELAFIPE, 
    c.VEI_VLR_VALORFORNECEDOR AS VALORFORNECEDOR,
	(v.VEN_PCO_COMISSAO) * ((v.VEN_VLR_VENDA)/ 100) AS VALORCOMISSAO,
	c.VEI_NUM_ANOFABRICACAO AS ANOFABRICACAO
	
FROM
	VEI_VEICULO c
JOIN
	MOD_MODELO m ON m.PK_MOD_IDMODELO = c.FK_MOD_IDMODELO_VEI
JOIN
	VEN_VENDA v ON c.PK_VEI_IDVEICULO = v.FK_VEI_IDVEICULO_VEN
JOIN 
	MAR_MARCA a ON a.PK_MAR_IDMARCA = m.FK_MAR_IDMARCA_MOD
JOIN 
	FUN_FUNCIONARIO fu ON fu.PK_FUN_IDFUNCIONARIO = v.FK_FUN_IDFUNCIONARIO_VEN
JOIN 
	CLI_CLIENTE cli ON cli.PK_CLI_IDCLIENTE = v.FK_CLI_IDCLIENTE_VEN;


CREATE VIEW RTV_RELATORIO_TOTAL_DE_VENDA AS
SELECT
	SUM(VALORVENDA) AS TOTAL_VENDA,
    SUM(VALORFORNECEDOR) AS TOTAL_FORNECEDORES,
	SUM(VALORCOMISSAO) AS TOTAL_COMISSAO,
	SUM(VALORVENDA) - SUM(VALORFORNECEDOR) - SUM(VALORCOMISSAO) AS SALDO
FROM 
	REL_RELATORIOFINANCEIRO;
